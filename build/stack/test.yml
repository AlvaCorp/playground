# Docker compose configuration for local development

# Includes a container to run commands locally - a Dockerized shell
testcli:
  image: playground:cli
  volumes:
   - .:/app
  links:
    - testdb:db
    - testnginx
  environment:
    #APP_PRETTY_URLS: 1
    YII_ENV: test
  command: "/app/build/stack/php-cli/run.sh"

# The php-fpm server for interpreting php code
testphpfpm:
  image: phundament/php:fpm
  links:
    - testdb:db
  volumes:
   - .:/app
  ports:
   - "9000"
  working_dir: '/app'
  environment:
    #APP_PRETTY_URLS: 1
    YII_ENV: test
    YII_DEBUG: true
    VIRTUAL_HOST: ~^test-playground\..*
    DB_ENV_MYSQL_DATABASE: test_playground-20
  command: "/app/build/stack/php-fpm/run.sh"

# The nginx server for serving static files directly, cached contents via the memcached server and php files via the php-fpm server
testnginx:
  image: nginx:1.7
  links:
    - testphpfpm:phpfpm
  volumes:
   - .:/app
  ports:
    - "80"
    - "443"
  environment:
    VIRTUAL_HOST: ~^playground\..*
    NGINX_ERROR_LOG_LEVEL: 'notice'
  working_dir: '/app'
  command: "/app/build/stack/nginx/run.sh"

testdb:
    image: mariadb
    ports:
        - "3306"
    expose:
        - "3306"
    environment:
        MYSQL_ROOT_PASSWORD: secretroot
        MYSQL_USER: dev
        MYSQL_PASSWORD: dev123
        MYSQL_DATABASE: playground-10

# Mailcatcher server for catching outgoing email when not in production
testmailcatcher:
  image: nisenabe/mailcatcher
  ports:
    - "25"
    - "1080"
